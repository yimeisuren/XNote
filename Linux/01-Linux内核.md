# Linux内核

## 内核功能

Linux系统的核心是内核. 内核控制着计算机系统上的所有硬件和软件, 在必要时分配硬件, 并根据需要执行软件.

内核主要负责以下4种功能:

+ <u>系统内存管理</u>

  内核不仅管理服务器上的可用物理内存, 还可以创建和管理虚拟内存(外存虚拟). 内核通过硬盘上的存储空间来实现虚拟内存, 这块区域称为==交换空间(swap space)==. 内核不断地交换<u>实际的物理内存和外存中交换空间</u>之间虚拟内存中的内容. 这使得系统以为它拥有比物理内存更多的可用内存.

  内存存储单元按组划分成很多块, 这些块称为<u>页面(page)</u>. 内核将页面放在物理内存或交换空间中. 然后内核维护一个内存页面表, 指明哪些页面位于物理内存中, 哪些页面被交换到交换空间中.

  内核会记录哪些内存页面正在使用, 并自动把一段时间未访问的内存页面复制到交换空间区域, 即使还有可用内存, 该过程称为<u>换出(swapping out)</u>. 当程序要访问一个在交换空间上的页面时, 内核需要为其分配物理内存或者换出另外一个内存页面.

+ <u>软件程序管理</u>

  内核创建<u>第一个进程(init进程)</u>, 从而启动系统上的其它所有进程. 当内核启动时, 它会将init进程加载到虚拟内存中. 内核在启动任何其它进程时, 都会在虚拟内存中给新进程分配一块专有区域来存储该进程用到的数据和代码.

  Linux操作系统采用了<u>运行级</u>. 运行级决定了init进程运行`/etc/inittab`文件或`/etc/rc[1-5].d`目录中定义好的某些特定类型的进程. Linux操作系统共有5个启动运行级.

  + 运行级为1时, 只启动基本的系统进程以及一个控制台终端进程, 我们称之为<u>单用户模式</u>. 单用户模式通常用来在系统有问题时进行紧急的文件系统维护, 在这种模式下, 只能由系统管理员登录到系统上操作数据.
  + 标准的启动运行级是3, 在这个运行级上大多数应用软件都会启动
  + 另一个常见的运行级是5, 在这个运行级上系统会启动图形化的X Window系统, 允许用户通过图形化桌面窗口登录系统.

+ <u>硬件设备管理</u>

  内核的另一职责是管理硬件设备, 任何Linux系统需要与之通信的设备, 都需要在内核代码中加入其驱动程序代码. 驱动程序代码相当于应用程序和硬件设备之间的中介, 允许内核与设备之间进行数据交换. 在Linux内核中有两种方式插入设备驱动代码:

  + 编译进内核的设备驱动代码
  + 可插入内核的设备驱动模块

  以前插入设备驱动代码的唯一途径是重新编译内核, 每次给系统添加新设备, 都需要重新编译一遍内核代码. 随着Linux内核支持的硬件设备越来越多, 这个过程变得越来越低效, Linux开发人员设计出一种更好的将驱动代码插入到运行中的内核的方法, 提出了<u>内核模块</u>的概念, **它允许将驱动代码插入到运行中的内核而无需重新编译内核, 同时当设备不再使用时也可以将内核模块从内核中移走**. 这种方式极大地简化和扩展了硬件设备在Linux上的使用.

  Linux系统将硬件设备当作特殊的文件, 称为设备文件. 设备文件共有3种分类:

  + **字符型设备文件**

    字符型设备文件是指处理数据时每次只能处理一个字符的设备. 大多数类型的调制解调器和终端都是作为字符型设备文件创建的.

  + **块设备文件**

    块设备文件是指处理数据时每次能处理大块数据的设备, 比如硬盘.

  + **网络设备文件**

    网络设备文件是指采用数据包发送和接收数据的设备, 包括各种网卡和一个特殊的回环设备. <u>这个回环设备允许Linux系统使用常见的网络编程协议同自身通信.</u>

  Linux为系统上的<u>每个设备</u>都创建一种称为<u>节点</u>的特殊文件. 与设备的所有通信都通过设备节点完成, 每个节点都有唯一的数值对作为其标识符, 包括一个主设备号和一个次设备号. 类似的设备被划分到同样的主设备号下, 次设备号用于标识主设备组下的某个特定设备.

+ <u>文件系统管理</u>

  Linux内核<u>支持通过不同类型的文件系统</u>从硬盘中读写数据. 内核必须在编译时就加入所有可能用到的文件系统的支持.

  Linux服务器中访问的所有硬盘都必须格式化成下表所列文件系统类型中的一种. Linux内核采用虚拟文件系统(VFS)作为和每个文件系统交互的接口. 这为Linux内核同任何类型文件系统通信提供了一个标准接口. 当每个文件系统都被挂载和使用时, VFS将信息都缓存在内存中.

<center>Linux文件系统</center>

| 文件系统 | 描述                                            |
| -------- | ----------------------------------------------- |
| ext      | Linux扩展文件系统, 最早的Linux文件系统          |
| ext2     | 第二扩展文件系统, 在ext的基础上提供了更多的功能 |
| ext3     | 第三扩展文件系统, 支持日志功能                  |
| ext4     | 第四扩展文件系统, 支持高级日志功能              |
| hpfs     | OS/2高性能文件系统                              |
| jfs      | ISM日志文件系统                                 |
|          |                                                 |
|          |                                                 |
|          |                                                 |

## GNU工具

核心GNU工具(core utilities)包括三个部分:

+ 管理进程的工具
+ 操作文本的工具
+ 处理文件的工具

shell工具为用户提供了启动程序, 管理文件系统中的文件以及运行在Linux系统上的进程的途径. 如果需要将多个shell命令放在一起工作执行, 则可以使用<u>shell脚本</u>.
